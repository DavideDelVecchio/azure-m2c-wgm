#!/bin/bash

# Bash shell script to upload blobs to Azure Storage with AzCopy.
# See https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-v10
#
# Database Name: {{ dbname }}
# Generated on:  {{ gen_timestamp }}

source env.sh

mkdir -p data/source/mongoexports

{% for c in collections %}
mongoexport \
  --host $M2C_SOURCE_MONGODB_HOST \
  --port $M2C_SOURCE_MONGODB_PORT \
  --db {{ dbname }} \
  --username $M2C_SOURCE_MONGODB_USER \
  --password $M2C_SOURCE_MONGODB_PASS \
  --collection {{ c['name'] }} \
  --out {{ outdir }}/{{ dbname }}__{{ c['name'] }}__source.json

az storage blob upload
    --container-name
    --file
    --name
    [--account-key]
    [--account-name]
    [--auth-mode {key, login}]
    [--connection-string]
    [--content-cache]
    [--content-disposition]
    [--content-encoding]
    [--content-language]
    [--content-md5]
    [--content-type]
    [--encryption-scope]
    [--if-match]
    [--if-modified-since]
    [--if-none-match]
    [--if-unmodified-since]
    [--lease-id]
    [--max-connections]
    [--maxsize-condition]
    [--metadata]
    [--no-progress]
    [--sas-token]
    [--socket-timeout]
    [--subscription]
    [--tier {P10, P20, P30, P4, P40, P50, P6, P60}]
    [--timeout]
    [--type {append, block, page}]
    [--validate-content]
{% endfor %}

echo 'done'
