#!/bin/bash

# Bash script to generate the mapping files from the extracted metadata.
# The mapping file is intended to be edited by the customer, while the
# metadata file is left untouched.
# Chris Joakim, Microsoft, June 2021

# Generated on: {{ gen_timestamp }}
# Generated by: {{ gen_by }}
# Template:     mongo_recreate_db.txt

# format: python main.py generate_mapping_file <db-name>

source env.sh

while true; do
    echo ''
    echo 'This process will overlay the mapping files you may have edited.'
    read -p "Do you wish to proceed - regenerate and overlay? " yn
    case $yn in
        [Yy]* ) break;;
        [Nn]* ) exit;;
        * ) echo "Please answer yes or no.";;
    esac
done

echo ''

{% for c in collections %}
python main.py generate_mapping_file {{ c['name'] }}
{% endfor %}

echo 'done'
