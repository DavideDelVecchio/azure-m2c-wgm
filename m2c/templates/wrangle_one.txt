#!/bin/bash

# Bash shell script to wrangle/transform a raw mongoexport file
#
# Database Name: {{ dbname }}
# Generated on:  {{ gen_timestamp }}
# Template:      wrangle.txt

source env.sh

mkdir -p tmp/{{ dbname }}

{% for c in collections %}

# download_blob(cname, blob_name, local_file_path)
python storage.py download_blob {{ dbname }}-raw {{ c['blob_name'] }} {{ c['local_file_path'] }} $1 $2 $3

#python wrangle.py transform \
#    --db {{ dbname }} \
#    --in-container {{ dbname }}-raw \
#    --blobname openflights__airports__source.json \
#    --filename tmp/openflights/openflights__airports__source.json \
#    --outfile  tmp/openflights/openflights__airports__wrangled.json \
#    --out-container openflights-adf

#python storage.py download_blob openflights-adf openflights__airports__wrangled.json tmp/downloaded_blob.json

{% endfor %}

echo 'done'
